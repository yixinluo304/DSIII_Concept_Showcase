"0","## Define aspects"
"0","aspects = ['location', 'service', 'room', 'staff']"
"0",""
"0","import pandas as pd"
"0","from transformers import pipeline"
"0","from concurrent.futures import ThreadPoolExecutor"
"0","from tqdm import tqdm"
"0",""
"0","df_sample = df.sample(1000, random_state=42) "
"0","df_sample['cleaned_review'] = df_sample['Review'].apply(clean_text)"
"0",""
"0","# Initialize DistilBERT pipeline"
"0","aspect_sentiment_pipeline = pipeline("
"0","    ""text-classification"","
"0","    model=""distilbert-base-uncased-finetuned-sst-2-english"","
"0","    truncation=True,"
"0","    padding=True"
"0",")"
"0",""
"0","# Function to handle missing aspects and perform sentiment analysis"
"0","def analyze_aspect_sentiments_with_missing_handling(review, aspects):"
"0","    aspect_sentiments = {}"
"0","    for aspect in aspects:"
"0","        # Check if the aspect is mentioned in the review"
"0","        if aspect in review:"
"0","            text = f""{review} What do you think about the {aspect}?"""
"0","            result = aspect_sentiment_pipeline(text)"
"0","            aspect_sentiments[aspect] = {"
"0","                'label': result[0]['label'],  # Positive, Neutral, or Negative"
"0","                'score': result[0]['score'] if result[0]['label'] == 'POSITIVE' else -result[0]['score']"
"0","            }"
"0","        else:"
"0","            # Assign default value if aspect is not mentioned"
"0","            aspect_sentiments[aspect] = {"
"0","                'label': 'Not Mentioned',"
"0","                'score': None"
"0","            }"
"0","    return aspect_sentiments"
"0","# Apply the function using multithreading for efficiency"
"0","with ThreadPoolExecutor(max_workers=4) as executor:"
"0","    results = list(tqdm(executor.map(lambda x: analyze_aspect_sentiments_with_missing_handling(x, aspects), "
"0","                                     df_sample['cleaned_review']), "
"0","                        total=len(df_sample)))"
"0","    "
"0","# Add results to the DataFrame"
"0","df_sample['aspect_sentiments'] = results"
"2","  0%|          | 0/1000 [00:00<?, ?it/s]"
"2","  0%|          | 1/1000 [00:00<02:41,  6.17it/s]"
"2","  0%|          | 2/1000 [00:00<02:18,  7.22it/s]"
"2","  0%|          | 3/1000 [00:00<03:28,  4.77it/s]"
"2","  0%|          | 4/1000 [00:00<03:01,  5.47it/s]"
"2","  1%|          | 7/1000 [00:00<01:33, 10.63it/s]"
"2","  1%|          | 12/1000 [00:01<00:58, 17.02it/s]"
"2","  1%|▏         | 14/1000 [00:01<01:01, 16.10it/s]"
"2","  2%|▏         | 17/1000 [00:01<01:16, 12.83it/s]"
"2","  2%|▏         | 21/1000 [00:01<01:34, 10.41it/s]"
"2","  3%|▎         | 31/1000 [00:02<00:48, 19.85it/s]"
"2","  3%|▎         | 34/1000 [00:02<00:50, 19.06it/s]"
"2","  4%|▎         | 37/1000 [00:03<01:49,  8.81it/s]"
"2","  6%|▌         | 56/1000 [00:03<00:48, 19.27it/s]"
"2","  6%|▌         | 60/1000 [00:03<00:47, 19.99it/s]"
"2","  6%|▋         | 64/1000 [00:04<00:44, 20.84it/s]"
"2","  7%|▋         | 67/1000 [00:04<00:44, 20.93it/s]"
"2","  7%|▋         | 70/1000 [00:04<00:45, 20.23it/s]"
"2","  7%|▋         | 73/1000 [00:04<00:48, 19.28it/s]"
"2","  8%|▊         | 76/1000 [00:04<01:02, 14.75it/s]"
"2","  9%|▊         | 86/1000 [00:05<00:42, 21.52it/s]"
"2","  9%|▉         | 91/1000 [00:05<00:42, 21.16it/s]"
"2"," 10%|█         | 100/1000 [00:05<00:36, 24.34it/s]"
"2"," 10%|█         | 103/1000 [00:05<00:40, 22.26it/s]"
"2"," 11%|█         | 106/1000 [00:06<00:39, 22.69it/s]"
"2"," 11%|█         | 109/1000 [00:06<01:27, 10.23it/s]"
"2"," 12%|█▏        | 120/1000 [00:07<00:45, 19.13it/s]"
"2"," 12%|█▏        | 124/1000 [00:07<00:41, 20.94it/s]"
"2"," 13%|█▎        | 128/1000 [00:07<00:45, 19.09it/s]"
"2"," 13%|█▎        | 131/1000 [00:07<00:46, 18.67it/s]"
"2"," 13%|█▎        | 134/1000 [00:07<00:50, 17.27it/s]"
"2"," 14%|█▍        | 141/1000 [00:07<00:33, 25.35it/s]"
"2"," 15%|█▍        | 146/1000 [00:08<00:29, 28.51it/s]"
"2"," 15%|█▌        | 150/1000 [00:08<00:48, 17.59it/s]"
"2"," 15%|█▌        | 154/1000 [00:08<00:42, 19.85it/s]"
"2"," 16%|█▌        | 160/1000 [00:08<00:39, 21.48it/s]"
"2"," 17%|█▋        | 167/1000 [00:09<00:33, 24.88it/s]"
"2"," 17%|█▋        | 170/1000 [00:09<01:01, 13.45it/s]"
"2"," 18%|█▊        | 177/1000 [00:09<00:43, 18.95it/s]"
"2"," 19%|█▊        | 186/1000 [00:10<00:33, 24.61it/s]"
"2"," 19%|█▉        | 190/1000 [00:10<00:31, 25.61it/s]"
"2"," 19%|█▉        | 194/1000 [00:10<00:43, 18.58it/s]"
"2"," 20%|██        | 200/1000 [00:10<00:42, 18.66it/s]"
"2"," 20%|██        | 203/1000 [00:11<01:19, 10.02it/s]"
"2"," 22%|██▏       | 220/1000 [00:12<00:35, 21.98it/s]"
"2"," 22%|██▎       | 225/1000 [00:12<00:33, 23.05it/s]"
"2"," 23%|██▎       | 229/1000 [00:12<00:49, 15.68it/s]"
"2"," 24%|██▎       | 237/1000 [00:13<00:38, 19.98it/s]"
"2"," 24%|██▍       | 242/1000 [00:13<00:37, 20.46it/s]"
"2"," 25%|██▍       | 248/1000 [00:13<00:33, 22.40it/s]"
"2"," 25%|██▌       | 254/1000 [00:13<00:35, 20.77it/s]"
"2"," 26%|██▌       | 259/1000 [00:14<00:53, 13.78it/s]"
"2"," 27%|██▋       | 271/1000 [00:14<00:32, 22.50it/s]"
"2"," 28%|██▊       | 275/1000 [00:14<00:31, 23.33it/s]"
"2"," 28%|██▊       | 279/1000 [00:15<00:34, 20.73it/s]"
"2"," 28%|██▊       | 283/1000 [00:15<00:33, 21.30it/s]"
"2"," 29%|██▊       | 286/1000 [00:15<00:36, 19.71it/s]"
"2"," 29%|██▉       | 293/1000 [00:16<00:43, 16.07it/s]"
"2"," 30%|██▉       | 296/1000 [00:16<00:46, 15.02it/s]"
"2"," 31%|███       | 306/1000 [00:16<00:34, 19.83it/s]"
"2"," 31%|███       | 312/1000 [00:17<00:48, 14.23it/s]"
"2"," 32%|███▏      | 320/1000 [00:17<00:36, 18.65it/s]"
"2"," 32%|███▏      | 324/1000 [00:17<00:38, 17.74it/s]"
"2"," 33%|███▎      | 332/1000 [00:17<00:28, 23.57it/s]"
"2"," 34%|███▎      | 336/1000 [00:18<00:31, 21.34it/s]"
"2"," 34%|███▍      | 339/1000 [00:18<00:30, 21.39it/s]"
"2"," 34%|███▍      | 342/1000 [00:18<00:29, 22.02it/s]"
"2"," 34%|███▍      | 345/1000 [00:18<00:39, 16.54it/s]"
"2"," 35%|███▌      | 351/1000 [00:18<00:30, 21.25it/s]"
"2"," 35%|███▌      | 354/1000 [00:19<00:34, 18.47it/s]"
"2"," 36%|███▌      | 358/1000 [00:19<00:42, 15.24it/s]"
"2"," 37%|███▋      | 366/1000 [00:19<00:31, 20.43it/s]"
"2"," 37%|███▋      | 371/1000 [00:19<00:25, 24.62it/s]"
"2"," 38%|███▊      | 375/1000 [00:20<00:36, 17.27it/s]"
"2"," 38%|███▊      | 380/1000 [00:20<00:34, 17.82it/s]"
"2"," 38%|███▊      | 383/1000 [00:20<00:43, 14.16it/s]"
"2"," 39%|███▉      | 388/1000 [00:21<00:47, 12.84it/s]"
"2"," 39%|███▉      | 391/1000 [00:21<00:48, 12.53it/s]"
"2"," 40%|████      | 400/1000 [00:21<00:30, 19.42it/s]"
"2"," 40%|████      | 403/1000 [00:21<00:30, 19.61it/s]"
"2"," 41%|████      | 410/1000 [00:22<00:27, 21.38it/s]"
"2"," 41%|████▏     | 413/1000 [00:22<00:33, 17.69it/s]"
"2"," 42%|████▏     | 420/1000 [00:22<00:29, 19.94it/s]"
"2"," 42%|████▎     | 425/1000 [00:23<00:28, 20.03it/s]"
"2"," 43%|████▎     | 428/1000 [00:23<00:34, 16.44it/s]"
"2"," 43%|████▎     | 433/1000 [00:23<00:34, 16.48it/s]"
"2"," 44%|████▎     | 435/1000 [00:24<00:41, 13.55it/s]"
"2"," 44%|████▍     | 441/1000 [00:24<00:41, 13.39it/s]"
"2"," 44%|████▍     | 444/1000 [00:24<00:47, 11.70it/s]"
"2"," 45%|████▍     | 446/1000 [00:25<00:57,  9.63it/s]"
"2"," 45%|████▌     | 453/1000 [00:25<00:49, 11.16it/s]"
"2"," 46%|████▌     | 461/1000 [00:26<00:37, 14.34it/s]"
"2"," 47%|████▋     | 466/1000 [00:26<00:36, 14.68it/s]"
"2"," 47%|████▋     | 468/1000 [00:26<00:41, 12.97it/s]"
"2"," 47%|████▋     | 474/1000 [00:26<00:34, 15.05it/s]"
"2"," 48%|████▊     | 478/1000 [00:27<00:32, 16.17it/s]"
"2"," 48%|████▊     | 485/1000 [00:27<00:24, 20.69it/s]"
"2"," 49%|████▉     | 489/1000 [00:28<00:40, 12.76it/s]"
"2"," 50%|████▉     | 498/1000 [00:28<00:30, 16.58it/s]"
"2"," 51%|█████     | 507/1000 [00:28<00:20, 23.88it/s]"
"2"," 51%|█████     | 511/1000 [00:28<00:27, 18.04it/s]"
"2"," 52%|█████▏    | 516/1000 [00:29<00:22, 21.62it/s]"
"2"," 52%|█████▏    | 520/1000 [00:29<00:24, 19.80it/s]"
"2"," 52%|█████▏    | 523/1000 [00:29<00:31, 14.95it/s]"
"2"," 53%|█████▎    | 530/1000 [00:29<00:25, 18.21it/s]"
"2"," 53%|█████▎    | 534/1000 [00:30<00:25, 18.19it/s]"
"2"," 54%|█████▎    | 537/1000 [00:30<00:34, 13.35it/s]"
"2"," 55%|█████▍    | 547/1000 [00:30<00:20, 21.70it/s]"
"2"," 55%|█████▌    | 552/1000 [00:30<00:18, 23.72it/s]"
"2"," 56%|█████▌    | 556/1000 [00:31<00:21, 20.97it/s]"
"2"," 56%|█████▌    | 561/1000 [00:31<00:20, 21.46it/s]"
"2"," 56%|█████▋    | 565/1000 [00:31<00:27, 15.85it/s]"
"2"," 57%|█████▋    | 574/1000 [00:31<00:17, 24.59it/s]"
"2"," 58%|█████▊    | 578/1000 [00:32<00:21, 19.61it/s]"
"2"," 59%|█████▉    | 588/1000 [00:33<00:30, 13.34it/s]"
"2"," 61%|██████    | 610/1000 [00:33<00:13, 28.72it/s]"
"2"," 62%|██████▏   | 617/1000 [00:33<00:14, 25.73it/s]"
"2"," 62%|██████▏   | 623/1000 [00:34<00:15, 24.34it/s]"
"2"," 63%|██████▎   | 628/1000 [00:34<00:18, 20.01it/s]"
"2"," 63%|██████▎   | 633/1000 [00:34<00:18, 20.16it/s]"
"2"," 64%|██████▍   | 641/1000 [00:35<00:15, 22.77it/s]"
"2"," 65%|██████▍   | 646/1000 [00:35<00:13, 25.30it/s]"
"2"," 65%|██████▌   | 650/1000 [00:35<00:15, 22.73it/s]"
"2"," 65%|██████▌   | 653/1000 [00:36<00:30, 11.41it/s]"
"2"," 67%|██████▋   | 668/1000 [00:36<00:14, 22.96it/s]"
"2"," 67%|██████▋   | 673/1000 [00:36<00:12, 25.29it/s]"
"2"," 68%|██████▊   | 678/1000 [00:37<00:16, 18.95it/s]"
"2"," 68%|██████▊   | 682/1000 [00:37<00:15, 20.00it/s]"
"2"," 69%|██████▊   | 686/1000 [00:37<00:19, 16.33it/s]"
"2"," 69%|██████▉   | 689/1000 [00:37<00:17, 17.93it/s]"
"2"," 70%|██████▉   | 695/1000 [00:37<00:12, 23.98it/s]"
"2"," 70%|██████▉   | 699/1000 [00:38<00:22, 13.36it/s]"
"2"," 70%|███████   | 704/1000 [00:38<00:18, 15.59it/s]"
"2"," 71%|███████   | 710/1000 [00:39<00:16, 17.16it/s]"
"2"," 72%|███████▏  | 717/1000 [00:39<00:12, 22.13it/s]"
"2"," 72%|███████▏  | 721/1000 [00:39<00:18, 14.95it/s]"
"2"," 73%|███████▎  | 730/1000 [00:39<00:12, 21.64it/s]"
"2"," 74%|███████▎  | 735/1000 [00:40<00:10, 24.88it/s]"
"2"," 74%|███████▍  | 739/1000 [00:40<00:17, 14.55it/s]"
"2"," 75%|███████▌  | 752/1000 [00:40<00:10, 24.34it/s]"
"2"," 76%|███████▌  | 756/1000 [00:40<00:09, 25.86it/s]"
"2"," 76%|███████▌  | 760/1000 [00:41<00:10, 23.64it/s]"
"2"," 76%|███████▋  | 765/1000 [00:41<00:09, 24.74it/s]"
"2"," 77%|███████▋  | 769/1000 [00:41<00:14, 15.76it/s]"
"2"," 78%|███████▊  | 775/1000 [00:42<00:12, 18.38it/s]"
"2"," 78%|███████▊  | 782/1000 [00:42<00:10, 20.95it/s]"
"2"," 78%|███████▊  | 785/1000 [00:42<00:12, 16.92it/s]"
"2"," 79%|███████▉  | 789/1000 [00:42<00:10, 19.43it/s]"
"2"," 79%|███████▉  | 793/1000 [00:43<00:11, 18.39it/s]"
"2"," 80%|████████  | 800/1000 [00:43<00:10, 19.70it/s]"
"2"," 80%|████████  | 805/1000 [00:44<00:15, 12.97it/s]"
"2"," 82%|████████▏ | 817/1000 [00:44<00:10, 18.24it/s]"
"2"," 82%|████████▏ | 824/1000 [00:44<00:07, 22.85it/s]"
"2"," 83%|████████▎ | 828/1000 [00:45<00:09, 17.83it/s]"
"2"," 83%|████████▎ | 833/1000 [00:45<00:08, 20.45it/s]"
"2"," 84%|████████▍ | 840/1000 [00:45<00:07, 20.21it/s]"
"2"," 84%|████████▍ | 843/1000 [00:45<00:09, 17.10it/s]"
"2"," 85%|████████▌ | 851/1000 [00:46<00:06, 23.07it/s]"
"2"," 86%|████████▌ | 857/1000 [00:46<00:08, 16.08it/s]"
"2"," 86%|████████▋ | 864/1000 [00:46<00:06, 20.82it/s]"
"2"," 87%|████████▋ | 868/1000 [00:47<00:06, 19.34it/s]"
"2"," 87%|████████▋ | 871/1000 [00:47<00:10, 12.39it/s]"
"2"," 88%|████████▊ | 882/1000 [00:47<00:05, 20.58it/s]"
"2"," 89%|████████▉ | 889/1000 [00:48<00:04, 23.60it/s]"
"2"," 89%|████████▉ | 893/1000 [00:48<00:04, 22.14it/s]"
"2"," 90%|████████▉ | 896/1000 [00:48<00:05, 19.29it/s]"
"2"," 90%|█████████ | 900/1000 [00:48<00:04, 20.28it/s]"
"2"," 91%|█████████ | 907/1000 [00:48<00:03, 25.97it/s]"
"2"," 91%|█████████ | 911/1000 [00:49<00:04, 20.69it/s]"
"2"," 92%|█████████▏| 918/1000 [00:49<00:04, 20.43it/s]"
"2"," 92%|█████████▏| 923/1000 [00:50<00:04, 16.24it/s]"
"2"," 93%|█████████▎| 933/1000 [00:50<00:02, 24.41it/s]"
"2"," 94%|█████████▎| 937/1000 [00:50<00:03, 17.42it/s]"
"2"," 94%|█████████▍| 942/1000 [00:50<00:02, 19.55it/s]"
"2"," 94%|█████████▍| 945/1000 [00:51<00:03, 17.99it/s]"
"2"," 95%|█████████▌| 953/1000 [00:51<00:03, 15.54it/s]"
"2"," 96%|█████████▋| 965/1000 [00:51<00:01, 23.41it/s]"
"2"," 97%|█████████▋| 971/1000 [00:52<00:01, 24.71it/s]"
"2"," 98%|█████████▊| 975/1000 [00:52<00:01, 18.86it/s]"
"2"," 98%|█████████▊| 982/1000 [00:52<00:00, 22.81it/s]"
"2"," 98%|█████████▊| 985/1000 [00:52<00:00, 19.55it/s]"
"2"," 99%|█████████▉| 988/1000 [00:53<00:00, 17.94it/s]"
"2"," 99%|█████████▉| 991/1000 [00:53<00:00, 13.34it/s]"
"2","100%|█████████▉| 995/1000 [00:53<00:00, 14.45it/s]"
"2","100%|██████████| 1000/1000 [00:53<00:00, 18.58it/s]
"
"0","# Extract aspect scores into a separate DataFrame"
"0","aspect_scores_df = pd.json_normalize(df_sample['aspect_sentiments'])"
"0",""
"0","print(df_sample[['Review', 'aspect_sentiments']].head())"
"0",""
"1","                                                  Review                                  aspect_sentiments
10957  worst exp, just got dissapointed, hotel midle ...  {'location': {'label': 'Not Mentioned', 'score...
6644   great, ok place gets reviews run gamut right, ...  {'location': {'label': 'Not Mentioned', 'score...
12619  did n't maid n't want re-write positive review...  {'location': {'label': 'NEGATIVE', 'score': -0...
15367  resort personality simpicity charm just got ba...  {'location': {'label': 'Not Mentioned', 'score...
4290   wonderful stay, stayed hotel new year holiday ...  {'location': {'label': 'POSITIVE', 'score': 0....
"
